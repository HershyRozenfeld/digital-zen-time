(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,i(o.key),o)}}function i(e){var i=function(e){if("object"!=t(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(i)?i:i+""}var n=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.lastActivity=Date.now(),this.isPageVisible=!document.hidden,this.activityThreshold=3e4,this.init()},(i=[{key:"init",value:function(){"chrome:"!==window.location.protocol&&"chrome-extension:"!==window.location.protocol&&(this.setupActivityListeners(),this.setupVisibilityListener(),this.startActivityReporting(),this.reportPageLoad())}},{key:"setupActivityListeners",value:function(){var t=this;["mousedown","mousemove","keypress","scroll","touchstart","click","focus","blur"].forEach(function(e){document.addEventListener(e,function(){t.updateActivity()},{passive:!0})}),document.addEventListener("input",function(){t.updateActivity()},{passive:!0}),document.addEventListener("play",function(){t.updateActivity()},!0),document.addEventListener("pause",function(){t.updateActivity()},!0)}},{key:"setupVisibilityListener",value:function(){var t=this;document.addEventListener("visibilitychange",function(){t.isPageVisible=!document.hidden,t.isPageVisible?(t.updateActivity(),t.reportPageVisible()):t.reportPageHidden()}),window.addEventListener("focus",function(){t.isPageVisible=!0,t.updateActivity(),t.reportPageVisible()}),window.addEventListener("blur",function(){t.isPageVisible=!1,t.reportPageHidden()})}},{key:"updateActivity",value:function(){this.lastActivity=Date.now()}},{key:"startActivityReporting",value:function(){var t=this;setInterval(function(){t.reportActivityStatus()},this.activityThreshold)}},{key:"reportPageLoad",value:function(){this.sendMessage({type:"PAGE_LOADED",data:{url:window.location.href,title:document.title,timestamp:Date.now()}})}},{key:"reportPageVisible",value:function(){this.sendMessage({type:"PAGE_VISIBLE",data:{url:window.location.href,timestamp:Date.now()}})}},{key:"reportPageHidden",value:function(){this.sendMessage({type:"PAGE_HIDDEN",data:{url:window.location.href,timestamp:Date.now()}})}},{key:"reportActivityStatus",value:function(){var t=Date.now()-this.lastActivity<this.activityThreshold&&this.isPageVisible;this.sendMessage({type:"ACTIVITY_STATUS",data:{url:window.location.href,isActive:t,lastActivity:this.lastActivity,isVisible:this.isPageVisible,timestamp:Date.now()}})}},{key:"sendMessage",value:function(t){try{chrome.runtime.sendMessage(t)}catch(t){console.debug("Could not send message to background script:",t)}}},{key:"detectSiteType",value:function(){var t=window.location.href.toLowerCase(),e=document.title.toLowerCase();return document.body&&document.body.innerText.toLowerCase(),this.containsAny(t,["facebook","instagram","twitter","linkedin","tiktok","snapchat"])?"social":this.containsAny(t,["youtube","netflix","twitch","hulu","disney"])?"entertainment":this.containsAny(t,["news","cnn","bbc","ynet","haaretz","mako"])||this.containsAny(e,["news","breaking","חדשות"])?"news":this.containsAny(t,["edu","coursera","udemy","khan","edx","wikipedia"])||this.containsAny(e,["course","learn","tutorial","קורס","לימוד"])?"education":this.containsAny(t,["shop","store","amazon","ebay","aliexpress"])||this.containsAny(e,["buy","cart","checkout","קנייה","חנות"])?"shopping":this.containsAny(t,["gmail","outlook","office","docs","drive","slack","teams","zoom"])||this.containsAny(e,["email","document","spreadsheet","presentation"])?"work":"other"}},{key:"containsAny",value:function(t,e){return e.some(function(e){return t.includes(e)})}},{key:"setupEnhancedTracking",value:function(){window.location.hostname.includes("youtube.com")&&this.trackYouTube(),"social"===this.detectSiteType()&&this.trackSocialMediaActivity(),this.estimateReadingActivity()}},{key:"trackYouTube",value:function(){var t=this;document.querySelectorAll("video").forEach(function(e){e.addEventListener("play",function(){t.sendMessage({type:"YOUTUBE_PLAY",data:{videoTitle:document.title,timestamp:Date.now()}})}),e.addEventListener("pause",function(){t.sendMessage({type:"YOUTUBE_PAUSE",data:{videoTitle:document.title,timestamp:Date.now()}})})})}},{key:"trackSocialMediaActivity",value:function(){var t=this,e=0,i=Date.now();window.addEventListener("scroll",function(){var n=Date.now();n-i>1e3&&(e++,i=n,e%10==0&&t.sendMessage({type:"SOCIAL_SCROLL",data:{scrollCount:e,timestamp:n}}))},{passive:!0})}},{key:"estimateReadingActivity",value:function(){var t=(document.body?document.body.innerText:"").split(/\s+/).length,e=60*Math.ceil(t/200)*1e3;this.sendMessage({type:"READING_ESTIMATE",data:{wordCount:t,estimatedTime:e,timestamp:Date.now()}})}}])&&e(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,i}();"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){new n}):new n})();